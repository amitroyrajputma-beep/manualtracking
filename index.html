<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-Sheet Google Viewer</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  .dark-mode {
    background-color: #0f172a !important;
    color: #e2e8f0 !important;
  }

  th {
    position: sticky;
    top: 0;
    background: #e2e8f0;
  }

  .dark-mode th {
    background: #1e293b !important;
  }

  .highlight {
    background-color: #fef08a !important;
  }

  .dark-mode .highlight {
    background-color: #92400e !important;
  }

  /* Mobile compact mode */
  @media (max-width: 768px) {
    table {
      font-size: 12px;
    }
    td, th {
      padding: 4px !important;
    }
  }
</style>
</head>

<body class="bg-gray-100 text-gray-900 p-4">

<!-- HEADER -->
<div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2">
  <h1 class="text-xl md:text-2xl font-bold">Google Sheet Viewer</h1>

  <div class="flex gap-2">
    <input id="searchBar" 
           type="text" 
           placeholder="Type exact value & press Enter"
           class="p-2 border rounded w-full md:w-64">
    
    <button onclick="toggleDarkMode()" 
            class="px-3 py-1 bg-gray-800 text-white rounded">
      üåô
    </button>
  </div>
</div>

<!-- SHEET TABS -->
<div id="tabs" class="flex flex-wrap gap-2 mb-4"></div>

<!-- TABLE OUTPUT -->
<div id="loader" class="text-lg">Loading‚Ä¶</div>
<div id="table-container" class="overflow-auto"></div>

<script>
/* ========= CONFIG ========= */
const docId = "1cuRsSTamB9qVay6iUTzH-lM-jRAEa6HA56DPS3WqaPQ";

const sheets = [
  { name: "Main Sheet", gid: "1955112487" },
  { name: "Sheet 1", gid: "510484958" },
  { name: "Sheet 2", gid: "1024028874" },
  { name: "Sheet 3", gid: "1020552709" },
  { name: "Sheet 4", gid: "1489763838" }
];

let allData = [];
let headers = [];
let sortDirection = {};
let activeSheet = sheets[0].gid;

/* ========= INIT ========= */
createTabs();
loadSheet(activeSheet);

/* ========= ENTER KEY SEARCH ========= */
document.getElementById("searchBar").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    applySearch();
  }
});

/* ========= DARK MODE ========= */
function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
}

/* ========= CREATE TABS ========= */
function createTabs() {
  const tabBar = document.getElementById("tabs");
  tabBar.innerHTML = "";

  sheets.forEach(s => {
    const btn = document.createElement("button");
    btn.textContent = s.name;
    btn.className =
      "px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700";

    btn.onclick = () => {
      activeSheet = s.gid;
      document.getElementById("searchBar").value = "";
      loadSheet(s.gid);
    };

    tabBar.appendChild(btn);
  });
}

/* ========= FAST CSV PARSER ========= */
function parseCSV(text) {
  const rows = [];
  let row = [];
  let cell = "";
  let inQuotes = false;

  for (let i = 0; i < text.length; i++) {
    const char = text[i];
    const nextChar = text[i + 1];

    if (char === '"' && inQuotes && nextChar === '"') {
      cell += '"';
      i++;
    } else if (char === '"') {
      inQuotes = !inQuotes;
    } else if (char === ',' && !inQuotes) {
      row.push(cell);
      cell = "";
    } else if (char === '\n' && !inQuotes) {
      row.push(cell);
      rows.push(row);
      row = [];
      cell = "";
    } else {
      cell += char;
    }
  }

  if (cell) row.push(cell);
  if (row.length) rows.push(row);

  return rows;
}

/* ========= LOAD SHEET ========= */
async function loadSheet(gid) {
  document.getElementById("loader").style.display = "block";
  document.getElementById("table-container").innerHTML = "";

  const csvUrl =
    `https://docs.google.com/spreadsheets/d/${docId}/export?format=csv&gid=${gid}`;

  const res = await fetch(csvUrl);
  const text = await res.text();

  const rows = parseCSV(text);

  headers = rows[0];
  allData = rows.slice(1);

  renderTable(allData);
  document.getElementById("loader").style.display = "none";
}

/* ========= EXACT SEARCH ========= */
function applySearch() {
  const searchText =
    document.getElementById("searchBar").value.trim().toLowerCase();

  if (!searchText) {
    renderTable(allData);
    return;
  }

  const filtered = allData.filter(row =>
    row.some(cell => cell.toLowerCase() === searchText)
  );

  renderTable(filtered, searchText);
}

/* ========= RENDER TABLE ========= */
function renderTable(data, highlightValue = null) {
  const container = document.getElementById("table-container");
  container.innerHTML = "";

  let html =
    `<table class="min-w-full border bg-white dark:bg-gray-800">
      <thead>
        <tr>
          ${headers
            .map(
              (h, i) =>
                `<th onclick="sortColumn(${i})"
                     class='px-2 py-1 border cursor-pointer text-xs md:text-sm'>
                     ${h} ‚¨ç
                 </th>`
            )
            .join("")}
        </tr>
      </thead>
      <tbody>`;

  data.forEach(row => {
    const isMatch =
      highlightValue &&
      row.some(cell => cell.toLowerCase() === highlightValue);

    html += `<tr class="${isMatch ? "highlight" : ""}">`;

    row.forEach(cell => {
      html += `<td class="border px-2 py-1 text-xs md:text-sm">${cell}</td>`;
    });

    html += "</tr>";
  });

  html += "</tbody></table>";

  container.innerHTML = html;
}

/* ========= SORT COLUMN ========= */
function sortColumn(i) {
  sortDirection[i] = !sortDirection[i];

  const sorted = [...allData].sort((a, b) =>
    sortDirection[i]
      ? a[i].localeCompare(b[i])
      : b[i].localeCompare(a[i])
  );

  renderTable(sorted);
}
</script>

</body>
</html>
