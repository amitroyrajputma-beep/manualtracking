<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-Sheet Google Viewer</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  .dark-mode {
    background-color: #0f172a !important;
    color: #e2e8f0 !important;
  }
  th {
    position: sticky;
    top: 0;
    background: #e2e8f0;
  }
  .dark-mode th {
    background: #1e293b !important;
  }
</style>
</head>

<body class="bg-gray-100 text-gray-900 p-4">

<!-- HEADER -->
<div class="flex items-center justify-between mb-4">
  <h1 class="text-2xl font-bold">Google Sheet Viewer</h1>
  <button onclick="toggleDarkMode()" class="px-3 py-1 bg-gray-800 text-white rounded">
    üåô Dark Mode
  </button>
</div>

<!-- SHEET TABS -->
<div id="tabs" class="flex flex-wrap space-x-2 mb-4"></div>

<!-- SEARCH BAR -->
<input id="searchBar" 
       type="text" 
       placeholder="Search‚Ä¶" 
       onkeyup="applyFilters()"
       class="w-full p-2 border rounded mb-4">

<!-- FILTERS -->
<div id="filters" class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"></div>

<!-- TABLE OUTPUT -->
<div id="loader" class="text-lg">Loading‚Ä¶</div>
<div id="table-container"></div>

<script>
/* ========= CONFIG ========= */
const docId = "1cuRsSTamB9qVay6iUTzH-lM-jRAEa6HA56DPS3WqaPQ";

const sheets = [
  { name: "Main Sheet", gid: "1955112487" },    // ‚Üê Your original sheet
  { name: "Sheet 1", gid: "510484958" },
  { name: "Sheet 2", gid: "1024028874" },
  { name: "Sheet 3", gid: "1020552709" },
  { name: "Sheet 4", gid: "1489763838" }
];

let allData = [];
let headers = [];
let sortDirection = {};
let activeSheet = sheets[0].gid;

/* ========= INIT ========= */
createTabs();
loadSheet(activeSheet);

/* ========= DARK MODE ========= */
function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
}

/* ========= CREATE TABS ========= */
function createTabs() {
  const tabBar = document.getElementById("tabs");
  tabBar.innerHTML = "";

  sheets.forEach(s => {
    const btn = document.createElement("button");
    btn.textContent = s.name;

    btn.className =
      "px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 mb-2";

    btn.onclick = () => {
      activeSheet = s.gid;
      loadSheet(s.gid);
    };

    tabBar.appendChild(btn);
  });
}

/* ========= LOAD SHEET ========= */
async function loadSheet(gid) {
  document.getElementById("loader").style.display = "block";
  document.getElementById("table-container").innerHTML = "";

  const csvUrl =
    `https://docs.google.com/spreadsheets/d/${docId}/export?format=csv&gid=${gid}`;

  const res = await fetch(csvUrl);
  const text = await res.text();
  const rows = text.trim().split("\n").map(r => r.split(","));

  headers = rows[0];
  allData = rows.slice(1);

  createFilters();
  renderTable(allData);

  document.getElementById("loader").style.display = "none";
}

/* ========= FILTERS ========= */
function createFilters() {
  const container = document.getElementById("filters");
  container.innerHTML = "";

  headers.forEach((h, columnIndex) => {
    const select = document.createElement("select");
    select.dataset.col = columnIndex;
    select.onchange = applyFilters;
    select.className = "p-2 border rounded w-full bg-white";

    const values = [...new Set(allData.map(r => r[columnIndex]))].sort();

    select.innerHTML =
      `<option value="">Filter ${h}</option>` +
      values.map(v => `<option value="${v}">${v}</option>`).join("");

    container.appendChild(select);
  });
}

/* ========= APPLY SEARCH + FILTER ========= */
function applyFilters() {
  const searchText =
    document.getElementById("searchBar").value.toLowerCase();

  const selects = document.querySelectorAll("#filters select");

  const filtered = allData.filter(row => {
    const textMatch = row.some(cell =>
      cell.toLowerCase().includes(searchText)
    );

    const filterMatch = [...selects].every(sel => {
      if (!sel.value) return true;
      return row[sel.dataset.col] === sel.value;
    });

    return textMatch && filterMatch;
  });

  renderTable(filtered);
}

/* ========= RENDER TABLE ========= */
function renderTable(data) {
  const container = document.getElementById("table-container");
  container.innerHTML = "";

  let html =
    `<table class="min-w-full border bg-white dark:bg-gray-800">
      <thead>
        <tr>
          ${headers
            .map(
              (h, i) =>
                `<th onclick="sortColumn(${i})"
                     class='px-3 py-2 border cursor-pointer'>
                     ${h} ‚¨ç
                 </th>`
            )
            .join("")}
        </tr>
      </thead>
      <tbody>`;

  data.forEach(row => {
    html += "<tr>";
    row.forEach(cell => {
      html += `<td class="border px-2 py-1">${cell}</td>`;
    });
    html += "</tr>";
  });

  html += "</tbody></table>";

  container.innerHTML = html;
}

/* ========= SORT COLUMN ========= */
function sortColumn(i) {
  sortDirection[i] = !sortDirection[i];

  const sorted = [...allData].sort((a, b) =>
    sortDirection[i]
      ? a[i].localeCompare(b[i])
      : b[i].localeCompare(a[i])
  );

  renderTable(sorted);
}
</script>

</body>
</html>
